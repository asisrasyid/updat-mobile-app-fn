<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Managament Finance</title>
		<link rel="manifest" href="/updat-mobile-app-fn/manifest.json" />
  		<meta name="theme-color" content="#4CAF50"/>
  		<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/906/906334.png" />

		<!-- all css -->
		<link rel="stylesheet" href="assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="assets/css/jquery-ui.css" />
		<link rel="stylesheet" href="assets/css/slick.css" />
		<link rel="stylesheet" href="assets/css/line-awesome.css" />
		<link rel="stylesheet" href="assets/css/nice-select.css" />
		<link rel="stylesheet" href="assets/css/style.css" />
		<link rel="stylesheet" href="assets/css/responsive.css" />
        <!-- <link rel="stylesheet" href="progres-bar.css"/> -->
    </head>

	<body >
		<!-- Preloader -->
        <div id="loadingOverlay" style="display:none;">
            <div class="spinner"></div>
          </div>
		<div class="preloader">
			<img src="assets/images/preloader.gif" alt="preloader" />
		</div>

		<!-- Settings -->
		<div class="theme_settings">
			<button type="button" id="settings_toggler">
				<i class="las la-cog"></i>
			</button>
			<h3>Settings</h3>

			<h5>Primary Colors</h5>
			<div class="setting_colors">
				<button data-color="#FD3D57" class="prime_1 change_prime_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#3498db" class="prime_2 change_prime_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#1abc9c" class="prime_3 change_prime_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#F79F1F" class="prime_4 change_prime_color">
					<i class="icon las la-check"></i>
				</button>
			</div>

			<h5>Secondary Colors</h5>
			<div class="setting_colors">
				<button data-color="#18181b" class="second_1 change_sec_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#1e293b" class="second_2 change_sec_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#374151" class="second_3 change_sec_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#44403c" class="second_4 change_sec_color">
					<i class="icon las la-check"></i>
				</button>
			</div>
            <h5>System shortcut</h5>
			<div class="mt-2">                 
				<button type="button" id="pembahruandata" class="btn btn-outline-primary">
					 Reload
				</button>
			</div>
		</div>
		<!-- top header -->
		<header class="home-3">
			<div class="container">
				<div class="d-flex align-items-center justify-content-sm-between">
					<div class="logo">
					</div>
					<div class="search_wrap d-none d-lg-block">
					</div>
					<div class="header_icon d-flex align-items-center ms-auto ms-sm-0">
						<div class="shopcart">
						</div>
						<div class="position-relative myacwrap home-1">
							<a href="javascript:void(0)" class="icon_wrp text-center myacc">
								<span class="icon">
									<i class="las la-user-circle" style="font-size: 30px;"></i>
								</span>
								<span class="icon_text">Account</span>
							</a>
							<div class="myacc_cont">
								<div class="ac_links">
									<a href="account.html" class="myac">
										<i class="lar la-id-card"></i>
										My Account
									</a>
									<a href="settup-fn.html">
										<i class="las la-robot"></i>
										Setting
									</a>
									<a href="javascript:void(0)" id="LogOutSistem">
										<i class="las la-power-off"></i>
										Log out
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>

		<!-- mobile bottom bar -->
		<div class="mobile_bottombar d-block d-lg-none">
			<div class="header_icon">
				<a href="index.html" class="icon_wrp text-center">
					<span class="icon">
						<i class="las la-chart-bar"></i>
					</span>
					<span class="icon_text">Dashboard</span>
				</a>
				<a href="javascript:void(0)" class="icon_wrp text-center open_menu">
					<span class="icon">
						<i class="las la-bars"></i>
					</span>
					<span class="icon_text">Menu</span>
				</a>
				<a href="Transaksi-save.html" class="icon_wrp text-center">
					<span class="icon">
						<i class="las la-edit"></i>
					</span>
					<span class="icon_text">Simpan Transaksi</span>
				</a>
			</div>
		</div>

		<!-- mobile menu -->
		<div class="mobile_menwrap d-lg-none" id="mobile_menwrap">
			<div class="mobile_menu_2">
				<h5 class="mobile_title">
					Menu
					<span class="sidebarclose" id="menuclose">
						<i class="las la-times"></i>
					</span>
				</h5>
				<ul>
					<li class="">
						<a href="index.html">Dashboard</a>
					</li>
					<li class="">
						<a href="plan-saveing.html">Saveing-Plan</a>
					</li>
					<li class=""> 
						<a href="budgeting-view.html">Budgeting</a>
					</li>
					<li class="">
						<a href="riwayat-transaksi.html">Riyawat Transaksi</a>
					</li>
				</ul>
			</div>
		</div>
        <!-- breadcrumbs -->
		<div class="container">
			<div class="breadcrumbs">
				<a href="index.html"><i class="las la-home"></i></a>
				<a href="#" class="active">Setting</a>
			</div>
		</div>

		<!-- account -->
		<div class="container">
            <div class="row">
                <!--  account sidebar  -->
                <div class="col-lg-3">
                    <div class="account_sidebar">
                        <div class="account_profile position-relative shadow_sm">
                            <div class="acprof_img">
                                <a href="account.html">
                                    <img loading="lazy" src="assets/images/avatar-2.png" alt="user" />
                                </a>
                            </div>
                            <div class="acprof_cont">
                                <p>Hello,</p>
                                <h4 class="output"></h4>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- account content -->
                <div class="col-lg-9">
                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs mb-4" id="savingTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="resume-tab" data-bs-toggle="tab" data-bs-target="#resume" type="button" role="tab">
								<i class="las la-file-invoice-dollar" style="font-size: 20px;"></i> Setup
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="new-plan-tab" data-bs-toggle="tab" data-bs-target="#new-plan" type="button" role="tab">
                                <i class="las la-user-circle" style="font-size: 20px;"></i> Account
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                                <i class="las la-link" style="font-size: 20px;"></i> Link
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
					<div class="tab-content" id="savingTabsContent">
						<!-- Resume Tab -->
						<div class="tab-pane fade show active" id="resume" role="tabpanel">
							<div class="card">
								<div class="card-body">
									<h4 class="mb-4">Buat Saving Plan Baru</h4>
									<form id="dataForm">
										<div class="row">
											<div class="col-md-6">
												<div class="single_billing_inp select-wrapper">
													<select class="" id="JenisTransaksi">
														<option>Pilih Jenis</option>
													</select>
												</div>
											</div>
											<div class="col-md-6">
												<div class="single_billing_inp select-wrapper">
													<select class="" id="keteranganDropdown">
														<option>Pilih Keterangan</option>
													</select>
												</div>
											</div>
											<div class="col-md-6">
												<div class="single_billing_inp select-wrapper">
													<select class="" id="enumDropdown">
														<option>Pilih Subkategori</option>
													</select>
												</div>
											</div>
											<input type="text" name="Jenis" id="inputJenis" hidden>
											<input type="text" name="Kategori" id="inputKategori" hidden>
											<input type="text" name="Subkategori" id="inputSubkategori" hidden>
											<div class="col-md-6">
												<div class="single_billing_inp">
													<input type="text" class="input-styled" name="Keterangan" placeholder="Keterangan" required />
												</div>
											</div>
											<div class="col-md-6">
												<div class="single_billing_inp">
												  <input type="number" class="input-styled" name="Jumlah" placeholder="Jumlah (Rp)" required />
												</div>
											  </div>
											  
											  <!-- Dropdown untuk sumber (jika jenis = pengeluaran) -->
											  <div class="col-md-6" id="dropdownSumberContainer">
												<div class="single_billing_inp select-wrapper">
												  <select class="" id="bySumber">
													<option value="">Pilih Sumber</option>
												  </select>
												</div>
											  </div>
											  
											  <!-- Input manual sumber (jika jenis ≠ pengeluaran) -->
											  <div class="col-md-6" id="inputSumberContainer" style="display: none;">
												<div class="single_billing_inp">
												  <input type="text" class="input-styled" id="manualSumberInput" placeholder="Masukkan Sumber" />
												</div>
											  </div>
											  
											  <!-- Hidden input yang akan disubmit ke server -->
											  <input type="text" name="Sumber" id="inputSumber" hidden />
											  
											<div class="col-12 acprof_subbtn">
												<button type="submit" class="default_btn rounded small" id="submitButton">Simpan Data</button>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>

						<!-- Progress Tab (Existing View) -->
						<div class="tab-pane fade" id="progress" role="tabpanel">
							<div id="data-container" class="shop_cart_wrap wishlist">
								<!-- Progress bar content will be loaded here by existing JavaScript -->
							</div>
						</div>

						<!-- New Plan Tab -->
						<div class="tab-pane fade" id="new-plan" role="tabpanel">
							<div class="card">
								<div class="card-body">
									<h4 class="mb-4">Buat Saving Plan Baru</h4>
									<form id="newPlanForm">
										<div class="mb-3">
											<label class="form-label">Judul Plan</label>
											<input type="text" class="form-control" id="planTitle" required>
										</div>
										<div class="mb-3">
											<label class="form-label">Target Nominal (Rp)</label>
											<input type="number" class="form-control" id="planTarget" required>
										</div>
										<div class="mb-3">
											<label class="form-label">Target Tanggal</label>
											<input type="date" class="form-control" id="planDeadline" required>
										</div>
										<div class="mb-3">
											<label class="form-label">Catatan (opsional)</label>
											<textarea class="form-control" id="planNotes" rows="3"></textarea>
										</div>
										<button type="submit" class="default_btn">Buat Plan</button>
									</form>
								</div>
							</div>
						</div>

						<!-- History Tab -->
						<div class="tab-pane fade" id="history" role="tabpanel">
							<div class="card">
								<div class="card-body">
									<h4 class="mb-4">Buat Saving Plan Baru</h4>
									<form id="newPlanForm">
										<div class="mb-3">
											<label class="form-label">Judul Plan</label>
											<input type="text" class="form-control" id="planTitle" required>
										</div>
										<div class="mb-3">
											<label class="form-label">Target Nominal (Rp)</label>
											<input type="number" class="form-control" id="planTarget" required>
										</div>
										<div class="mb-3">
											<label class="form-label">Target Tanggal</label>
											<input type="date" class="form-control" id="planDeadline" required>
										</div>
										<div class="mb-3">
											<label class="form-label">Catatan (opsional)</label>
											<textarea class="form-control" id="planNotes" rows="3"></textarea>
										</div>
										<button type="submit" class="default_btn">Buat Plan</button>
									</form>
								</div>
							</div>
						</div>
					</div>
                </div>
            </div>
        </div>

		<!-- copyright -->
		<div class="copyright_wrap">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-md-6">
						<p class="copyright_text">2025 | Finance Management</p>
					</div>
				</div>
			</div>
		</div>
		<script>
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('service-worker.js')
					.then(() => console.log("✅ Service Worker registered"))
					.catch(err => console.log("❌ SW error", err));
			}
		</script> 
		<!-- all js -->
		<script src="assets/js/bootstrap.bundle.min.js"></script>
		<script src="assets/js/jquery-3.5.1.min.js"></script>
		<script src="assets/js/jquery-ui.min.js"></script>
		<script src="assets/js/slick.min.js"></script>
		<script src="assets/js/jquery.nice-select.min.js"></script>
		<script src="assets/js/app.js"></script>
        <script src="progersbar.js"></script>      
		<script>
			const spid = localStorage.getItem('spid');
const id = localStorage.getItem('id')
const email = localStorage.getItem('email')

const SPREADSHEET_URL = `https://script.google.com/macros/s/AKfycbxX0U_DDwXQ9WjTlytdzk1O2ZJk2eu-7nivoCMBAlaZts0mCDvO3u2va-xV60Wi-bak_Q/exec?spid=${spid}&id=${id}&email=${email}`;

		//const spid = localStorage.getItem('spid');
		//const SPREADSHEET_URL = `https://script.google.com/macros/s/AKfycbxX0U_DDwXQ9WjTlytdzk1O2ZJk2eu-7nivoCMBAlaZts0mCDvO3u2va-xV60Wi-bak_Q/exec?spid=${spid}`;

		const spreadsheetUrl = `${SPREADSHEET_URL}&dataset=accdta`; 
		const savedUser = localStorage.getItem('user');
    	const outputElements = document.querySelectorAll('.output');
		if (savedUser) {
			outputElements.forEach(el => el.textContent = savedUser);
            $('.preloader').fadeOut(500, function(){ $('.preloader').remove(); } );
		 }
		 else {
			window.location.href = "login.html"; 	
		 }
		</script>
		<script>
			document.getElementById("LogOutSistem").addEventListener("click", function (e) {
			  e.preventDefault(); 
			  localStorage.clear(); 
			  window.location.href = "index.html"; 
			});
		</script>
        <script> 
        function formatRupiah(number) {
            return Number(number).toLocaleString('id-ID');
        }
        function formatBulanTahun(dateStr) {
            const bulan = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
          const date = new Date(dateStr);
          const namaBulan = bulan[date.getMonth()];
          const tahun = date.getFullYear();
          return `${namaBulan}-${tahun}`;
        }
            
        function tampilkanDataKeUI(data) {
          const container = document.getElementById('data-container'); // pastikan kamu punya <div id="data-container"></div> di HTML-mu
          container.innerHTML = ''; // Kosongkan dulu
        
          data.forEach(item => {
            const el = document.createElement('div');
            el.className = 'single_shop_cart d-flex align-items-center flex-wrap';
            el.innerHTML = `
              <div class="cart_cont">
                <a href="product-view.html"><h5>${item.judul}</h5></a>
                <p class="instock mb-0">Deadline : <span>${formatBulanTahun(item.target_tanggal)}</span></p>
                <div class="cart_price ms-md-auto ms-0">
                  <p>${formatRupiah(item.target_nominal)}</p>
                </div>
              </div>
              <div class="page-wrap">  
                <div class="meter">
                  <span class="progress" style="width: ${item.persen_tercapai}%"></span>
                  <div class="label">${item.persen_tercapai}% / ${formatRupiah(item.nominal_dikumpulkan)}</div>
                </div>
              </div>
            `;
            container.appendChild(el);
          });
          $('.preloader').fadeOut(500, function(){ $('.preloader').remove(); } );
        }
        function ambilData() {
            const dataLocal = localStorage.getItem('saving_plan');
    		const spreadsheetUrlSvdt = `${SPREADSHEET_URL}&dataset=trgSave`; 

            if (dataLocal) {
              const parsedData = JSON.parse(dataLocal);
              tampilkanDataKeUI(parsedData);
            } else {
              fetch(spreadsheetUrlSvdt) 
                .then(res => res.json())
                .then(res => {
                  localStorage.setItem('saving_plan', JSON.stringify(res.value));
                  tampilkanDataKeUI(res.value);
                })
                .catch(err => console.error('Gagal ambil data:', err));
            }
        }
        document.addEventListener('DOMContentLoaded', ambilData);
        const submitButton = document.getElementById("pembahruandata");   
		document.getElementById("pembahruandata").addEventListener("click", function(event) {
            event.preventDefault();
            document.getElementById("loadingOverlay").style.display = "flex";
    		const spreadsheetUrlSvdt = `${SPREADSHEET_URL}&dataset=trgSave`; 
            fetch(spreadsheetUrlSvdt) 
                .then(res => res.json())
                .then(res => {
                  localStorage.setItem('saving_plan', JSON.stringify(res.value));
                  window.location.reload();
                  //tampilkanDataKeUI(res.value);
                })
                .catch(err => {console.error('Gagal ambil data:', err); document.getElementById("loadingOverlay").style.display = "none";});
        });
        </script>
		<script>
			// Update summary in Resume tab
			function updateResumeSummary(data) {
				let totalTarget = 0;
				let totalCollected = 0;

				data.forEach(item => {
					totalTarget += parseFloat(item.target_nominal);
					totalCollected += parseFloat(item.nominal_dikumpulkan);
				});

				document.getElementById('totalTargetResume').textContent = formatRupiah(totalTarget);
				document.getElementById('totalCollectedResume').textContent = formatRupiah(totalCollected);
				document.getElementById('remainingTargetResume').textContent = formatRupiah(totalTarget - totalCollected);
			}

			// Modify existing ambilData function
			function ambilData() {
				const dataLocal = localStorage.getItem('saving_plan');
				const spreadsheetUrlSvdt = `${SPREADSHEET_URL}&dataset=trgSave`; 

				if (dataLocal) {
					const parsedData = JSON.parse(dataLocal);
					tampilkanDataKeUI(parsedData);
					updateResumeSummary(parsedData);
				} else {
					fetch(spreadsheetUrlSvdt) 
						.then(res => res.json())
						.then(res => {
							localStorage.setItem('saving_plan', JSON.stringify(res.value));
							tampilkanDataKeUI(res.value);
							updateResumeSummary(res.value);
						})
						.catch(err => console.error('Gagal ambil data:', err));
				}
			}

			// Add new plan handler
			document.getElementById('newPlanForm').addEventListener('submit', function(e) {
				e.preventDefault();
				// Add your logic here to save new plan
				// This is just a placeholder - implement according to your needs
				alert('Fitur ini akan segera tersedia!');
			});

			// Load saving history
			function loadSavingHistory(period = 'week') {
				const history = JSON.parse(localStorage.getItem('saving_history')) || [];
				const tbody = document.getElementById('savingHistory');
				tbody.innerHTML = '';

				// Filter logic here
				history.forEach(item => {
					tbody.innerHTML += `
						<tr>
							<td>${new Date(item.date).toLocaleDateString('id-ID')}</td>
							<td>${item.title}</td>
							<td>${formatRupiah(item.amount)}</td>
							<td><span class="badge bg-success">${item.status}</span></td>
							<td>${item.notes || '-'}</td>
						</tr>
					`;
				});
			}

			// Period filter buttons
			document.querySelectorAll('[data-period]').forEach(button => {
				button.addEventListener('click', (e) => {
					document.querySelectorAll('[data-period]').forEach(btn => {
						btn.classList.remove('active');
					});
					e.target.classList.add('active');
					loadSavingHistory(e.target.dataset.period);
				});
			});

			// Initialize history on load
			document.addEventListener('DOMContentLoaded', () => {
				loadSavingHistory();
			});
		</script>
	</body>
</html>
