<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Managament Finance</title>
		<link rel="manifest" href="/updat-mobile-app-fn/manifest.json" />
  		<meta name="theme-color" content="#4CAF50"/>
  		<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/906/906334.png" />

		<!-- all css -->
		<link rel="stylesheet" href="assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="assets/css/jquery-ui.css" />
		<link rel="stylesheet" href="assets/css/slick.css" />
		<link rel="stylesheet" href="assets/css/line-awesome.css" />
		<link rel="stylesheet" href="assets/css/nice-select.css" />
		<link rel="stylesheet" href="assets/css/style.css" />
		<link rel="stylesheet" href="assets/css/responsive.css" />
        <!-- <link rel="stylesheet" href="progres-bar.css"/> -->
    </head>

	<body>
		<!-- Preloader -->
        <div id="loadingOverlay" style="display:none;">
            <div class="spinner"></div>
          </div>
		<div class="preloader">
			<img src="assets/images/preloader.gif" alt="preloader" />
		</div>

		<!-- Settings -->
		<div class="theme_settings">
			<button type="button" id="settings_toggler">
				<i class="las la-cog"></i>
			</button>
			<h3>Settings</h3>

			<h5>Primary Colors</h5>
			<div class="setting_colors">
				<button data-color="#FD3D57" class="prime_1 change_prime_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#3498db" class="prime_2 change_prime_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#1abc9c" class="prime_3 change_prime_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#F79F1F" class="prime_4 change_prime_color">
					<i class="icon las la-check"></i>
				</button>
			</div>

			<h5>Secondary Colors</h5>
			<div class="setting_colors">
				<button data-color="#18181b" class="second_1 change_sec_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#1e293b" class="second_2 change_sec_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#374151" class="second_3 change_sec_color">
					<i class="icon las la-check"></i>
				</button>
				<button data-color="#44403c" class="second_4 change_sec_color">
					<i class="icon las la-check"></i>
				</button>
			</div>
            <h5>System shortcut</h5>
			<div class="mt-2">                 
				<button type="button" id="pembahruandata" class="btn btn-outline-primary">
					 Reload
				</button>
			</div>
		</div>
		<!-- top header -->
		<header class="home-3">
			<div class="container">
				<div class="d-flex align-items-center justify-content-sm-between">
					<div class="logo">
					</div>
					<div class="search_wrap d-none d-lg-block">
					</div>
					<div class="header_icon d-flex align-items-center ms-auto ms-sm-0">
						<div class="shopcart">
						</div>
						<div class="position-relative myacwrap home-1">
							<a href="javascript:void(0)" class="icon_wrp text-center myacc">
								<span class="icon">
									<i class="las la-user-circle" style="font-size: 30px;"></i>
								</span>
								<span class="icon_text">Account</span>
							</a>
							<div class="myacc_cont">
								<div class="ac_links">
									<a href="account.html" class="myac">
										<i class="lar la-id-card"></i>
										My Account
									</a>
									<a href="settup-fn.html">
										<i class="las la-robot"></i>
										Setting
									</a>
									<a href="javascript:void(0)" id="LogOutSistem">
										<i class="las la-power-off"></i>
										Log out
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>

		<nav class="d-none d-lg-block home-3">
			<div class="container">
				<div class="d-flex">
					<ul class="nav_bar flex-grow-1">
						<li class="withsubs">
							<a href="index-1.html"
								>Home <span><i class="las la-angle-down"></i></span
							></a>
							<ul class="subnav">
								<li><a href="index-1.html">Home page 1 </a></li>
								<li><a href="index-2.html">Home page 2</a></li>
								<li><a href="index-3.html">Home page 3</a></li>
							</ul>
						</li>
						<li class="withsubs">
							<a href="shop-list.html"
								>Shop <span><i class="las la-angle-down"></i></span
							></a>
							<ul class="subnav">
								<li><a href="shop-list.html">List view </a></li>
								<li><a href="shop-grid.html">Grid view</a></li>
								<li><a href="shop-grid-2.html">Grid view 2</a></li>

								<li><a href="shopping-cart.html">Shopping cart</a></li>
								<li><a href="product-view.html">Product view</a></li>
							</ul>
						</li>
						<li class="withsubs">
							<a href="shop-list.html"
								>Pages <span><i class="las la-angle-down"></i></span
							></a>
							<div class="subnav py-3 px-2 d-flex gx-4">
								<div class="single_subnav">
									<h5 class="text_lg ps-3 mb-2">Others pages</h5>
									<ul>
										<li><a href="about-us.html">About us</a></li>
										<li><a href="contact-us.html">Contact us</a></li>

										<li><a href="track-order.html">Track order</a></li>
										<li><a href="faq.html">FAQ</a></li>
										<li><a href="404.html">404</a></li>
									</ul>
								</div>
								<div class="single_subnav">
									<h5 class="text_lg ps-3 mb-2">Account pages</h5>
									<ul>
										<li><a href="account.html">My Account</a></li>
										<li><a href="login.html">Login</a></li>
										<li><a href="register.html">Register</a></li>
										<li><a href="shop-grid.html">Forgot password</a></li>
									</ul>
								</div>
								<div class="single_subnav">
									<h5 class="text_lg ps-3 mb-2">Checkout page</h5>
									<ul>
										<li><a href="shop-list.html">Checkout</a></li>
										<li><a href="shop-list.html">Payment</a></li>
										<li><a href="shop-list.html">Payment success</a></li>
									</ul>
								</div>
							</div>
						</li>
						<li><a href="contact-us.html">contact</a></li>
						
					</ul>
				</div>
			</div>
		</nav>

		<!-- mobile bottom bar -->
		<div class="mobile_bottombar d-block d-lg-none">
			<div class="header_icon">
				<a href="index.html" class="icon_wrp text-center">
					<span class="icon">
						<i class="las la-chart-bar"></i>
					</span>
					<span class="icon_text">Dashboard</span>
				</a>
				<a href="javascript:void(0)" class="icon_wrp text-center open_menu">
					<span class="icon">
						<i class="las la-bars"></i>
					</span>
					<span class="icon_text">Menu</span>
				</a>
				<a href="Transaksi-save.html" class="icon_wrp text-center">
					<span class="icon">
						<i class="las la-edit"></i>
					</span>
					<span class="icon_text">Simpan Transaksi</span>
				</a>
			</div>
		</div>

		<!-- mobile menu -->
		<div class="mobile_menwrap d-lg-none" id="mobile_menwrap">
			<div class="mobile_menu_2">
				<h5 class="mobile_title">
					Menu
					<span class="sidebarclose" id="menuclose">
						<i class="las la-times"></i>
					</span>
				</h5>
				<ul>
					<li class="">
						<a href="index.html">Dashboard</a>
					</li>

					<li class="">
						<a href="plan-saveing.html">Saveing-Plan</a>
					</li>
					<li class=""> 
						<a href="budgeting-view.html">Budgeting</a>
					</li>
					<li class="">
						<a href="riwayat-transaksi.html">Riyawat Transaksi</a>
					</li>
				</ul>
			</div>
		</div>
        <!-- breadcrumbs -->
		<div class="container">
			<div class="breadcrumbs">
				<a href="index.html"><i class="las la-home"></i></a>
				<a href="#" class="active">Saveing-Plan</a>
			</div>
		</div>

		<!-- account -->
		<div class="my_account_wrap section_padding_b">
			<div class="container">
				<div class="row">
					<!--  account sidebar  -->
					<div class="col-lg-3">
						<div class="account_sidebar">
							<div class="account_profile position-relative shadow_sm">
								<div class="acprof_img">
									<a href="account.html">
										<img loading="lazy" src="assets/images/avatar-2.png" alt="user" />
									</a>
								</div>
								<div class="acprof_cont">
									<p>Hello,</p>
									<h4 class="output"></h4>
								</div>
								<div class="profile_hambarg d-lg-none d-block">
									<i class="las la-bars"></i>
								</div>
							</div>
						</div>
					</div>
					<!-- account content -->
					<div class="col-lg-9">
						<!-- Tab Navigation -->
						<ul class="nav nav-tabs mb-4" id="savingTabs" role="tablist">
							<li class="nav-item" role="presentation">
								<button class="nav-link active" id="resume-tab" data-bs-toggle="tab" data-bs-target="#resume" type="button" role="tab">
									<i class="las la-chart-pie"></i> Resume
								</button>
							</li>
							<li class="nav-item" role="presentation">
								<button class="nav-link" id="progress-tab" data-bs-toggle="tab" data-bs-target="#progress" type="button" role="tab">
									<i class="las la-chart-line"></i> Progress
								</button>
							</li>
							<li class="nav-item" role="presentation">
								<button class="nav-link" id="new-plan-tab" data-bs-toggle="tab" data-bs-target="#new-plan" type="button" role="tab">
									<i class="las la-plus-circle"></i> Buat Plan
								</button>
							</li>
							<li class="nav-item" role="presentation">
								<button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
									<i class="las la-history"></i> Riwayat
								</button>
							</li>
						</ul>

						<!-- Tab Content -->
						<div class="tab-content" id="savingTabsContent">
							<!-- Resume Tab -->
							<div class="tab-pane fade show active" id="resume" role="tabpanel">
								<div class="row mb-4">
									<div class="col-md-4">
										<div class="budget_card">
											<div class="budget_card_header">
												<h4>Total Target</h4>
												<i class="las la-bullseye"></i>
											</div>
											<div class="budget_card_body">
												<h3 id="totalTargetResume">Rp 0</h3>
												<p>Semua Plan</p>
											</div>
										</div>
									</div>
									<div class="col-md-4">
										<div class="budget_card">
											<div class="budget_card_header">
												<h4>Total Terkumpul</h4>
												<i class="las la-piggy-bank"></i>
											</div>
											<div class="budget_card_body">
												<h3 id="totalCollectedResume">Rp 0</h3>
												<p>Semua Plan</p>
											</div>
										</div>
									</div>
									<div class="col-md-4">
										<div class="budget_card">
											<div class="budget_card_header">
												<h4>Sisa Target</h4>
												<i class="las la-coins"></i>
											</div>
											<div class="budget_card_body">
												<h3 id="remainingTargetResume">Rp 0</h3>
												<p>Semua Plan</p>
											</div>
										</div>
									</div>
								</div>
							</div>

							<!-- Progress Tab (Existing View) -->
							<div class="tab-pane fade" id="progress" role="tabpanel">
								<div id="data-container" class="shop_cart_wrap wishlist">
									<!-- Progress bar content will be loaded here by existing JavaScript -->
								</div>
							</div>

							<!-- New Plan Tab -->
							<div class="tab-pane fade" id="new-plan" role="tabpanel">
								<div class="card">
									<div class="card-body">
										<h4 class="mb-4">Buat Saving Plan Baru</h4>
										<form id="newPlanForm">
											<div class="mb-3">
												<label class="form-label">Judul Plan</label>
												<input type="text" class="form-control" id="planTitle" required>
											</div>
											<div class="mb-3">
												<label class="form-label">Target Nominal (Rp)</label>
												<input type="number" class="form-control" id="planTarget" required>
											</div>
											<div class="mb-3">
												<label class="form-label">Target Tanggal</label>
												<input type="date" class="form-control" id="planDeadline" required>
											</div>
											<div class="mb-3">
												<label class="form-label">Catatan (opsional)</label>
												<textarea class="form-control" id="planNotes" rows="3"></textarea>
											</div>
											<button type="submit" class="default_btn">Buat Plan</button>
										</form>
									</div>
								</div>
							</div>

							<!-- History Tab -->
							<div class="tab-pane fade" id="history" role="tabpanel">
								<div class="budget_categories">
									<div class="d-flex justify-content-between align-items-center mb-3">
										<h4>Riwayat Saving Plan</h4>
										<div class="btn-group">
											<button class="default_btn btn-sm active" data-period="week">Minggu Ini</button>
											<button class="default_btn btn-sm" data-period="month">Bulan Ini</button>
											<button class="default_btn btn-sm" data-period="year">Tahun Ini</button>
										</div>
									</div>
									<div class="table-responsive">
										<table class="table">
											<thead>
												<tr>
													<th>Tanggal</th>
													<th>Judul Plan</th>
													<th>Nominal</th>
													<th>Status</th>
													<th>Keterangan</th>
												</tr>
											</thead>
											<tbody id="savingHistory">
												<!-- Data akan diisi melalui JavaScript -->
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- copyright -->
		<div class="copyright_wrap">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-md-6">
						<p class="copyright_text">2025 | Finance Management</p>
					</div>
				</div>
			</div>
		</div>

		<!-- product quick view -->
		<div class="product_quickview">
			<div class="prodquick_wrap position-relative">
				<div class="close_quickview">
					<i class="las la-times"></i>
				</div>
				<div class="row">
					<div class="col-lg-6">
						<div class="product_view_slider">
							<div class="single_viewslider">
								<img loading="lazy" src="assets/images/slider-1.png" alt="product" />
							</div>
							<div class="single_viewslider">
								<img loading="lazy" src="assets/images/slider-2.png" alt="product" />
							</div>
							<div class="single_viewslider">
								<img loading="lazy" src="assets/images/slider-3.png" alt="product" />
							</div>
							<div class="single_viewslider">
								<img loading="lazy" src="assets/images/slider-4.png" alt="product" />
							</div>
							<div class="single_viewslider">
								<img loading="lazy" src="assets/images/slider-5.png" alt="product" />
							</div>
							<div class="single_viewslider">
								<img loading="lazy" src="assets/images/slider-1.png" alt="product" />
							</div>
						</div>
						<div class="product_viewslid_nav">
							<div class="single_viewslid_nav">
								<img loading="lazy" src="assets/images/slider-1.png" alt="product" />
							</div>
							<div class="single_viewslid_nav">
								<img loading="lazy" src="assets/images/slider-2.png" alt="product" />
							</div>
							<div class="single_viewslid_nav">
								<img loading="lazy" src="assets/images/slider-3.png" alt="product" />
							</div>
							<div class="single_viewslid_nav">
								<img loading="lazy" src="assets/images/slider-4.png" alt="product" />
							</div>
							<div class="single_viewslid_nav">
								<img loading="lazy" src="assets/images/slider-5.png" alt="product" />
							</div>
							<div class="single_viewslid_nav">
								<img loading="lazy" src="assets/images/slider-1.png" alt="product" />
							</div>
						</div>
					</div>
					<div class="col-lg-6">
						<div class="product_info_wrapper">
							<div class="product_base_info">
								<h1>MEN'S ADIDAS COURTSMASH</h1>
								<div class="rating">
									<div class="d-flex align-items-center">
										<div class="rating_star">
											<span><i class="las la-star"></i></span>
											<span><i class="las la-star"></i></span>
											<span><i class="las la-star"></i></span>
											<span><i class="las la-star"></i></span>
											<span><i class="las la-star"></i></span>
										</div>
										<p class="rating_count">50 Reviews</p>
									</div>
								</div>
								<div class="product_other_info">
									<p><span class="text-semibold">Availability:</span><span class="text-green">In Stock</span></p>
									<p><span class="text-semibold">Brand:</span>Bata</p>
									<p><span class="text-semibold">Category:</span>Clothing</p>
									<p><span class="text-semibold">SKU:</span>BE45VGRT</p>
								</div>
								<div class="price mt-3 mb-3 d-flex align-items-center">
									<span class="prev_price ms-0">$5000.00</span>
									<span class="org_price ms-2">$4500.00</span>
									<div class="disc_tag ms-3">-30%</div>
								</div>
								<div class="pd_dtails">
									<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Enim exercitationem quaerat....</p>
								</div>
								<div class="shop_filter border-bottom-0 pb-0">
									<div class="size_selector mb-3">
										<h5>Size</h5>
										<div class="d-flex align-items-center">
											<div class="single_size_opt">
												<input type="radio" hidden name="size" class="size_inp" id="size-xs" />
												<label for="size-xs">XS</label>
											</div>
											<div class="single_size_opt ms-2">
												<input type="radio" hidden name="size" class="size_inp" id="size-s" />
												<label for="size-s">S</label>
											</div>
											<div class="single_size_opt ms-2">
												<input type="radio" hidden name="size" class="size_inp" id="size-m" checked />
												<label for="size-m">M</label>
											</div>
											<div class="single_size_opt ms-2">
												<input type="radio" hidden name="size" class="size_inp" id="size-l" />
												<label for="size-l">L</label>
											</div>
											<div class="single_size_opt ms-2">
												<input type="radio" hidden name="size" class="size_inp" id="size-xl" />
												<label for="size-xl">XL</label>
											</div>
										</div>
									</div>
									<div class="size_selector color_selector">
										<h5>Color:</h5>
										<div class="d-flex align-items-center">
											<div class="single_size_opt">
												<input type="radio" hidden name="color" class="size_inp" id="color-purple" />
												<label for="color-purple" class="bg-color" data-bs-toggle="tooltip" title="Rose Red"></label>
											</div>
											<div class="single_size_opt ms-2">
												<input type="radio" hidden name="color" class="size_inp" id="color-red" />
												<label for="color-red" class="bg-white" data-bs-toggle="tooltip" title="White"></label>
											</div>
											<div class="single_size_opt ms-2">
												<input type="radio" hidden name="color" class="size_inp" id="color-green" checked />
												<label for="color-green" class="bg-dark" data-bs-toggle="tooltip" title="Black"></label>
											</div>
										</div>
									</div>
								</div>
								<div class="cart_qnty ms-md-auto">
									<p>Quantity</p>
									<div class="d-flex align-items-center">
										<div class="cart_qnty_btn">
											<i class="las la-minus"></i>
										</div>
										<div class="cart_count">4</div>
										<div class="cart_qnty_btn">
											<i class="las la-plus"></i>
										</div>
									</div>
								</div>
							</div>
							<div class="product_buttons">
								<a href="#" class="default_btn me-sm-3 me-2 px-2 px-lg-4"><i class="icon-cart me-2"></i> Add to Cart</a>
								<a href="#" class="default_btn second px-3 px-ms-4"><i class="icon-heart me-2"></i> Wishlist</a>
							</div>
							<div class="share_icons footer_icon d-flex">
								<a href="#"><i class="lab la-facebook-f"></i></a>
								<a href="#"><i class="lab la-twitter"></i></a>
								<a href="#"><i class="lab la-instagram"></i></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('service-worker.js')
					.then(() => console.log("✅ Service Worker registered"))
					.catch(err => console.log("❌ SW error", err));
			}
		</script> 
		<!-- all js -->
		<script src="assets/js/bootstrap.bundle.min.js"></script>
		<script src="assets/js/jquery-3.5.1.min.js"></script>
		<script src="assets/js/jquery-ui.min.js"></script>
		<script src="assets/js/slick.min.js"></script>
		<script src="assets/js/jquery.nice-select.min.js"></script>
		<script src="assets/js/app.js"></script>
        <script src="progersbar.js"></script>      
		<script>
			const spid = localStorage.getItem('spid');
			const id = localStorage.getItem('id')
			const email = localStorage.getItem('email')

			const SPREADSHEET_URL = `https://script.google.com/macros/s/AKfycbxX0U_DDwXQ9WjTlytdzk1O2ZJk2eu-7nivoCMBAlaZts0mCDvO3u2va-xV60Wi-bak_Q/exec?spid=${spid}&id=${id}&email=${email}`;



		//const spid = localStorage.getItem('spid');
		//const SPREADSHEET_URL = `https://script.google.com/macros/s/AKfycbxX0U_DDwXQ9WjTlytdzk1O2ZJk2eu-7nivoCMBAlaZts0mCDvO3u2va-xV60Wi-bak_Q/exec?spid=${spid}`;

		const spreadsheetUrl =`${SPREADSHEET_URL}&dataset=accdta`; 
		const savedUser = localStorage.getItem('user');
    	const outputElements = document.querySelectorAll('.output');
		if (savedUser) {
			outputElements.forEach(el => el.textContent = savedUser);
		 }
		 else {
			window.location.href = "login.html"; 	
		 }
		</script>
		<script>
			document.getElementById("LogOutSistem").addEventListener("click", function (e) {
			  e.preventDefault(); 
			  localStorage.clear(); 
			  window.location.href = "index.html"; 
			});
		</script>
        <script> 
        function formatRupiah(number) {
            return Number(number).toLocaleString('id-ID');
        }
        function formatBulanTahun(dateStr) {
            const bulan = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
          const date = new Date(dateStr);
          const namaBulan = bulan[date.getMonth()];
          const tahun = date.getFullYear();
          return `${namaBulan}-${tahun}`;
        }
            
        function tampilkanDataKeUI(data) {
          const container = document.getElementById('data-container'); // pastikan kamu punya <div id="data-container"></div> di HTML-mu
          container.innerHTML = ''; // Kosongkan dulu
        
          data.forEach(item => {
            const el = document.createElement('div');
            el.className = 'single_shop_cart d-flex align-items-center flex-wrap';
            el.innerHTML = `
              <div class="cart_cont">
                <a href="product-view.html"><h5>${item.judul}</h5></a>
                <p class="instock mb-0">Deadline : <span>${formatBulanTahun(item.target_tanggal)}</span></p>
                <div class="cart_price ms-md-auto ms-0">
                  <p>${formatRupiah(item.target_nominal)}</p>
                </div>
              </div>
              <div class="page-wrap">  
                <div class="meter">
                  <span class="progress" style="width: ${item.persen_tercapai}%"></span>
                  <div class="label">${item.persen_tercapai}% / ${formatRupiah(item.nominal_dikumpulkan)}</div>
                </div>
              </div>
            `;
            container.appendChild(el);
          });
          $('.preloader').fadeOut(500, function(){ $('.preloader').remove(); } );
        }
        function ambilData() {
            const dataLocal = localStorage.getItem('saving_plan');
    		const spreadsheetUrlSvdt = `${SPREADSHEET_URL}&dataset=trgSave`; 

            if (dataLocal) {
              const parsedData = JSON.parse(dataLocal);
              tampilkanDataKeUI(parsedData);
            } else {
              fetch(spreadsheetUrlSvdt) 
                .then(res => res.json())
                .then(res => {
                  localStorage.setItem('saving_plan', JSON.stringify(res.value));
                  tampilkanDataKeUI(res.value);
                })
                .catch(err => console.error('Gagal ambil data:', err));
            }
        }
        document.addEventListener('DOMContentLoaded', ambilData);
        const submitButton = document.getElementById("pembahruandata");   
		document.getElementById("pembahruandata").addEventListener("click", function(event) {
            event.preventDefault();
            document.getElementById("loadingOverlay").style.display = "flex";
    		const spreadsheetUrlSvdt = `${SPREADSHEET_URL}&dataset=trgSave`; 
            fetch(spreadsheetUrlSvdt) 
                .then(res => res.json())
                .then(res => {
                  localStorage.setItem('saving_plan', JSON.stringify(res.value));
                  window.location.reload();
                  //tampilkanDataKeUI(res.value);
                })
                .catch(err => {console.error('Gagal ambil data:', err); document.getElementById("loadingOverlay").style.display = "none";});
        });
        </script>
		<script>
			// Update summary in Resume tab
			function updateResumeSummary(data) {
				let totalTarget = 0;
				let totalCollected = 0;

				data.forEach(item => {
					totalTarget += parseFloat(item.target_nominal);
					totalCollected += parseFloat(item.nominal_dikumpulkan);
				});

				document.getElementById('totalTargetResume').textContent = formatRupiah(totalTarget);
				document.getElementById('totalCollectedResume').textContent = formatRupiah(totalCollected);
				document.getElementById('remainingTargetResume').textContent = formatRupiah(totalTarget - totalCollected);
			}

			// Modify existing ambilData function
			function ambilData() {
				const dataLocal = localStorage.getItem('saving_plan');
				const spreadsheetUrlSvdt = `${SPREADSHEET_URL}&dataset=trgSave`; 

				if (dataLocal) {
					const parsedData = JSON.parse(dataLocal);
					tampilkanDataKeUI(parsedData);
					updateResumeSummary(parsedData);
				} else {
					fetch(spreadsheetUrlSvdt) 
						.then(res => res.json())
						.then(res => {
							localStorage.setItem('saving_plan', JSON.stringify(res.value));
							tampilkanDataKeUI(res.value);
							updateResumeSummary(res.value);
						})
						.catch(err => console.error('Gagal ambil data:', err));
				}
			}

			// Add new plan handler
			document.getElementById('newPlanForm').addEventListener('submit', function(e) {
				e.preventDefault();
				// Add your logic here to save new plan
				// This is just a placeholder - implement according to your needs
				alert('Fitur ini akan segera tersedia!');
			});

			// Load saving history
			function loadSavingHistory(period = 'week') {
				const history = JSON.parse(localStorage.getItem('saving_history')) || [];
				const tbody = document.getElementById('savingHistory');
				tbody.innerHTML = '';

				// Filter logic here
				history.forEach(item => {
					tbody.innerHTML += `
						<tr>
							<td>${new Date(item.date).toLocaleDateString('id-ID')}</td>
							<td>${item.title}</td>
							<td>${formatRupiah(item.amount)}</td>
							<td><span class="badge bg-success">${item.status}</span></td>
							<td>${item.notes || '-'}</td>
						</tr>
					`;
				});
			}

			// Period filter buttons
			document.querySelectorAll('[data-period]').forEach(button => {
				button.addEventListener('click', (e) => {
					document.querySelectorAll('[data-period]').forEach(btn => {
						btn.classList.remove('active');
					});
					e.target.classList.add('active');
					loadSavingHistory(e.target.dataset.period);
				});
			});

			// Initialize history on load
			document.addEventListener('DOMContentLoaded', () => {
				loadSavingHistory();
			});
		</script>
	</body>
</html>
